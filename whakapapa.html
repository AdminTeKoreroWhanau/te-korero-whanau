<!doctype html>
<html lang="mi">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Whakapapa â€” Te KÅrero WhÄnau</title>
    <meta name="description" content="Whakapapa: Build our whÄnau tree and connections." />
    <link rel="stylesheet" href="assets/styles.css" />
  </head>
  <body>
    <header class="papa">
      <div class="logo">Te KÅrero WhÄnau</div>
      <nav>
        <button class="nav-toggle" aria-expanded="false" aria-controls="whanau-nav" title="Whakatuwhera tahua / Open menu">â‰¡</button>
        <button id="theme-toggle" class="theme-toggle" aria-pressed="false" title="KÅwhiri Ähua / Toggle theme">â˜€ï¸</button>
        <ul id="whanau-nav" class="nav-list">
          <li><a href="index.html">KÄinga</a></li>
          <li><a href="whakapapa.html">Whakapapa</a></li>
          <li><a href="korero.html">KÅrero</a></li>
          <li><a href="hui.html">Hui</a></li>
          <li><a href="mahi.html">Mahi</a></li>
          <li><a href="tauparapara.html">Tauparapara</a></li>
          <li><a href="nga-toi.html">NgÄ Toi</a></li>
          <li id="nav-admin-item" style="display:none"><a href="admin.html">Kaiwhakahaere</a></li>
          <li id="nav-login-item"><a id="open-auth" href="#">Takiuru</a></li>
          <li id="nav-profile-item" style="display:none"><a href="profile.html">KÅtaha</a></li>
          <li id="nav-signout-item" style="display:none"><a id="signout" href="#">Takiputa</a></li>
        </ul>
      </nav>
    </header>

    <main>
      <section id="whakapapa" class="panel">
        <h1>Whakapapa</h1>
        <p>He rÄkau whÄnau, he hononga tÄngata. PÄwhiria tÄ“tahi uri ki te tiro i tÅna kÅtaha. / Family tree and connections. Click any member to view their profile.</p>
        <details class="fold">
          <summary>What info is helpful for whakapapa?</summary>
          <p>Full names, birth years, marae, iwi/hapÅ«, and known relationships. Photos are a bonus.</p>
        </details>

        <p id="whakapapa-msg" class="muted"></p>

        <!-- Toolbar -->
        <div class="toolbar" role="group" aria-label="Whakapapa controls" style="display:flex; gap:.5rem; flex-wrap:wrap; align-items:center; margin:.5rem 0 1rem;">
          <button id="fit" class="btn outline" type="button">Fit</button>
          <button id="save-layout" class="btn" type="button" style="display:none">ğŸ’¾ Tiaki TÄhanga / Save Layout</button>
          <span id="save-msg" class="small muted"></span>
        </div>

        <!-- Admin hint -->
        <p id="whakapapa-admin-hint" class="small muted" style="display:none; margin:0 0 .5rem;">
          Kumea ngÄ nÅta ki te whakarite i te rÄkau, kÄtahi ka tiaki. / Drag nodes to arrange the tree, then save.
        </p>

        <div id="whakapapa-tree" style="height: 520px; border: 1px solid var(--border); border-radius: .5rem;" aria-busy="false"></div>

        <!-- Admin forms (hidden by default, shown for admin users) -->
        <div id="whakapapa-admin-forms" style="display:none;">
          <div class="grid" style="margin-top:1rem; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 1rem;">
            <article class="card">
              <div class="card-body">
                <h3>TÄpirihia he tangata / Add person</h3>
                <form id="person-form" class="form">
                  <label>KÅwhiria te kÅtaha / Select profile
                    <select id="person-select"></select>
                  </label>
                  <button id="person-add-btn" type="submit" class="btn">TÄpiri / Add</button>
                  <p class="small muted">Avatars and names come from user profiles.</p>
                  <p id="person-msg" class="small muted"></p>
                </form>
              </div>
            </article>

            <article class="card">
              <div class="card-body">
                <h3>TÄpirihia he hononga / Add relationship</h3>
                <form id="rel-form" class="form">
                  <label>Tangata A
                    <select id="rel-a"></select>
                  </label>
                  <label>Momo / Type
                    <select id="rel-type">
                      <option value="parent">MÄtua / Parent â†’ Child</option>
                      <option value="mother">Whaea / Mother â†’ Child</option>
                      <option value="father">Matua / Father â†’ Child</option>
                      <option value="spouse">Hoa rangatira / Spouse</option>
                      <option value="partner">Hoa / Partner</option>
                      <option value="sibling">Tuakana/Teina / Sibling</option>
                    </select>
                  </label>
                  <label>Tangata B
                    <select id="rel-b"></select>
                  </label>
                  <button type="submit" class="btn">TÄpiri / Add</button>
                  <p id="rel-msg" class="small muted"></p>
                </form>
              </div>
            </article>
          </div>
        </div>
      </section>

    </main>

    <!-- Auth modal -->
    <div id="auth-modal" class="modal" hidden aria-hidden="true" role="dialog" aria-labelledby="auth-title">
      <div class="modal-content">
        <button class="modal-close" aria-label="Katia te matapihi / Close" id="auth-close">Ã—</button>
        <h2 id="auth-title">Takiuru / RÄ“hita</h2>
        <div class="tabpanes">
          <form id="login-form" class="form" autocomplete="on">
            <label>Email
              <input type="email" name="email" required />
            </label>
            <label>Kupuhipa / Password
              <input type="password" name="password" required minlength="6" />
            </label>
            <button type="submit" class="btn">Takiuru</button>
            <p class="muted small" id="login-msg"></p>
          </form>
          <form id="register-form" class="form" autocomplete="on" hidden>
            <label>Ingoa / Full name (optional)
              <input type="text" name="full_name" />
            </label>
            <label>Email
              <input type="email" name="email" required />
            </label>
            <label>Kupuhipa / Password
              <input type="password" name="password" required minlength="6" />
            </label>
            <button type="submit" class="btn">RÄ“hita</button>
            <p class="muted small" id="register-msg"></p>
          </form>
        </div>
      </div>
    </div>

    <footer>
      <small>Â© <span id="year"></span> Te KÅrero WhÄnau â€” He taonga tuku iho.</small>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="assets/config.js"></script>
    <script src="assets/auth.js"></script>
    <script src="assets/whanau.js"></script>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <script src="assets/whakapapa.js"></script>
    <script src="assets/app.js"></script>
  </body>
</html>
